---
import CodeCard from "@components/CodeCard.astro";
import Layout from "@layouts/Layout.astro";
import { getCollection } from "astro:content";
import { css } from "styled-system/css";
import { grid } from "styled-system/patterns";

const allSnippets = await getCollection("snippets");
---

<script>
  const handleCopy = async (
    block: HTMLPreElement,
    snackbar: Element | null
  ) => {
    await navigator.clipboard.writeText(block.innerText);
    snackbar?.classList.add("show");
    snackbar?.classList.remove("hide");

    setTimeout(() => {
      snackbar?.classList.remove("show");
      snackbar?.classList.add("hide");
    }, 3000);
  };

  const cards = document.querySelectorAll("[data-copy]");
  const snackbar = document.querySelector("[data-snackbar]");

  cards.forEach((card) => {
    const blocks = card.querySelectorAll("pre");
    blocks.forEach((block) => {
      card.addEventListener("click", () => handleCopy(block, snackbar));
    });
  });
</script>

<Layout title="Kitto">
  <section
    class={css({
      display: "flex",
      overflowY: "auto",
      h: "screen",
      p: 4,
      gap: 4,
    })}
  >
    <span
      class={css({
        fontSize: "6xl",
        p: 4,
        color: "primary",
        fontWeight: "bold",
      })}
    >
      Kitto
    </span>
    <div
      class={grid({
        columns: 3,
        gap: "4",
        h: "full",
      })}
    >
      {
        allSnippets.map((snippet) => (
          <div data-copy>
            <CodeCard
              title={snippet.data.title}
              tags={snippet.data.tags}
              code={snippet.data.code}
              lang={snippet.data.lang}
            />
          </div>
        ))
      }
    </div>
  </section>
  <span
    data-snackbar
    class={css({
      rounded: "full",
      position: "absolute",
      justifyContent: "center",
      alignItems: "center",
      color: "green.300",
      backgroundColor: "green.950",
      borderColor: "green.800",
      bottom: "0",
      left: 0,
      right: 0,
      borderWidth: 1,
      py: 1.5,
      px: 4,
      width: "fit-content",
      ml: "auto",
      mr: "auto",
      transition: "transform 0.1s ease-in-out",
    })}
  >
    Copi√©
  </span>
</Layout>

<style>
  [data-snackbar] {
    transform: translateY(150%);
  }

  [data-snackbar].show {
    transform: translateY(-100%);
  }

  [data-snackbar].hide {
    /* opacity: 0; */
    transform: translateY(150%);
  }
</style>

---
import CodeCard from "@components/CodeCard.astro";
import Layout from "@layouts/Layout.astro";
import { getCollection } from "astro:content";
import { css } from "styled-system/css";
import { grid } from "styled-system/patterns";

const allSnippets = await getCollection("snippets");
---

<script>
  const handleCopy = async (
    block: HTMLPreElement,
    snackbar: Element | null
  ) => {
    await navigator.clipboard.writeText(block.innerText);
    snackbar?.classList.replace("d_none", "d_flex");

    setTimeout(() => {
      snackbar?.classList.replace("d_flex", "d_none");
    }, 3000);
  };

  const cards = document.querySelectorAll("[data-copy]");
  const snackbar = document.querySelector("[data-snackbar]");

  cards.forEach((card) => {
    const blocks = card.querySelectorAll("pre");
    blocks.forEach((block) => {
      card.addEventListener("click", () => handleCopy(block, snackbar));
    });
  });
</script>

<Layout title="Kitto">
  <section>
    <span
      data-snackbar
      class={css({
        display: "none",
        position: "absolute",
        justifyContent: "center",
        alignItems: "center",
        color: "red.700",
        top: 3,
        left: 0,
        right: 0,
        borderWidth: 1,
        py: 1.5,
        px: 2,
        width: "fit-content",
        ml: "auto",
        mr: "auto",
      })}
    >
      Copi√©
    </span>
    <span
      class={css({
        fontSize: "6xl",
        p: 4,
        color: "primary",
        fontWeight: "bold",
      })}
    >
      Kitto
    </span>
    <div class={grid({ columns: 2, gap: "4" })}>
      {
        allSnippets.map((snippet) => (
          <div data-copy>
            <CodeCard
              title={snippet.data.title}
              tags={snippet.data.tags}
              code={snippet.data.code}
              lang={snippet.data.lang}
            />
          </div>
        ))
      }
    </div>
  </section>
</Layout>
